<a id="readme-top"></a>


<!-- PROJECT LOGO -->
<br />
<div align="center">
  <h3 align="center">p2p-data-aggregation</h3>
  <p align="center">
    Data Aggregation using Anti-Entropy algorithm in a P2P network using gRPC.
  </p>
</div>


<!-- ABOUT THE PROJECT -->
## About

This project was developed as one of the assignments in the Distributed Systems class of my Master's degree at FCUP.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## Assignment

- Create a network of 6 peers (p1 to p6), running on different machines (m1 to m6), with the topology shown in the figure above.

- Peers must have a thread waiting for others to connect and register themselves. This is how peers get to know each other, and the network is built.

- Each peer keeps a map data structure (e.g., Map or HashMap in Java) with the IPs/names of the machines of the peers that have registered themselves with it. For example, peer p2 (in machine m2) keeps the entries [m1, m3, m4] whereas peer p6 (in machine m6) keeps only [m4].

- Each peer initially generates a random double value v in the range (0, 1) and exchanges this value with its neighbours.

- This synchronization process uses the Anti-Entropy algorithm and follows a Poisson distribution with a frequency of 2 per minute. A peer chooses a random neighbour from its map and synchronizes the current value with it.

- In a synchronization, two peers Pi and Pj exchange their current values. Afterwards, the resulting value in both Pi and Pj will be (vi + vj )/2.

- Once this process starts, the value held by each peer will converge to the average of all values originally generated by the peers.

- Change your peers to allow them to receive a specific value when they start running. Try this with all peers set to 0 except for one that is initialized to 1. Observe the behavior of the system. Notice that this converges to the average of all values, which will be, in this case, 1/N where N is the number of peers in the network. Thus, after a while, the size of the network will be known to all peers.

- **[EXTRA MARKS:]** Create a script that builds a connected network of N such peers with a random topology. As above, the peers should be initialized to 0 except for one, which is initialized to 1. Run simulations for different values of N . Create a plot that shows the convergence time towards 1/N as a function of N.

<p align="right">(<a href="#readme-top">back to top</a>)</p>


### Built With

These are some of the tools used to build this project.

* `rand` for random number generation.
* `serde` for json serialization and deserialization.
* `tonic` for gRPC communication between peers.
* `clap` for command-line argument passing.
* `color-print` for making it look nice.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- GETTING STARTED -->
## Getting Started

### Prerequisites

In order to run build this application from source you will need to have `cargo`, `protobuf compiler` `docker` and `python` installed.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### Installation
1. Clone the repository
   ```sh
   git clone https://github.com/diogogomesaraujo/p2p-data-aggregation.git
   ```
2. Build the project
   ```sh
   cargo build
   ```

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### Run the Project
#### Manually
1. Navigate to the project's directory
2. Run the following command for all peers. You may connect to as many peers as you want as long as you list them all.
   
   ```sh
   cargo run -- <INITIAL_VALUE> <NUMBER_OF_PEERS> <OWN_ADDRESS> <PEER_ADDRESS> ...
   ```
#### Example

   ```sh
   # peers
   cargo run -- 0 3 127.0.0.1:3000
   cargo run -- 0 3 127.0.0.1:3001 127.0.0.1:3000
   cargo run -- 1 3 127.0.0.1:3002 127.0.0.1:3000 127.0.0.1:3001
   ```

<p align="right">(<a href="#readme-top">back to top</a>)</p>

#### With Build Script
1. Navigate to the project's directory
2. Run the following command to execute experiments with random topologies and generate a plot of runtime as a function of total peer count.
   
   ```sh
   python plot.py
   ```
#### Example
<div align="center">
   <img src="./convergence_plot.png" alt="Plot">
</div>

<p align="right">(<a href="#readme-top">back to top</a>)</p>


<!-- MARKDOWN LINKS & IMAGES -->
<!-- https://www.markdownguide.org/basic-syntax/#reference-style-links -->
[contributors-shield]: https://img.shields.io/github/contributors/othneildrew/Best-README-Template.svg?style=for-the-badge
[contributors-url]: https://github.com/othneildrew/Best-README-Template/graphs/contributors
[forks-shield]: https://img.shields.io/github/forks/othneildrew/Best-README-Template.svg?style=for-the-badge
[forks-url]: https://github.com/othneildrew/Best-README-Template/network/members
[stars-shield]: https://img.shields.io/github/stars/othneildrew/Best-README-Template.svg?style=for-the-badge
[stars-url]: https://github.com/othneildrew/Best-README-Template/stargazers
[issues-shield]: https://img.shields.io/github/issues/othneildrew/Best-README-Template.svg?style=for-the-badge
[issues-url]: https://github.com/othneildrew/Best-README-Template/issues
[license-shield]: https://img.shields.io/github/license/othneildrew/Best-README-Template.svg?style=for-the-badge
[license-url]: https://github.com/othneildrew/Best-README-Template/blob/master/LICENSE.txt
[linkedin-shield]: https://img.shields.io/badge/-LinkedIn-black.svg?style=for-the-badge&logo=linkedin&colorB=555
[linkedin-url]: https://linkedin.com/in/othneildrew
[product-screenshot]: images/screenshot.png
[Next.js]: https://img.shields.io/badge/next.js-000000?style=for-the-badge&logo=nextdotjs&logoColor=white
[Next-url]: https://nextjs.org/
[React.js]: https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB
[React-url]: https://reactjs.org/
[Vue.js]: https://img.shields.io/badge/Vue.js-35495E?style=for-the-badge&logo=vuedotjs&logoColor=4FC08D
[Vue-url]: https://vuejs.org/
[Angular.io]: https://img.shields.io/badge/Angular-DD0031?style=for-the-badge&logo=angular&logoColor=white
[Angular-url]: https://angular.io/
[Svelte.dev]: https://img.shields.io/badge/Svelte-4A4A55?style=for-the-badge&logo=svelte&logoColor=FF3E00
[Svelte-url]: https://svelte.dev/
[Laravel.com]: https://img.shields.io/badge/Laravel-FF2D20?style=for-the-badge&logo=laravel&logoColor=white
[Laravel-url]: https://laravel.com
[Bootstrap.com]: https://img.shields.io/badge/Bootstrap-563D7C?style=for-the-badge&logo=bootstrap&logoColor=white
[Bootstrap-url]: https://getbootstrap.com
[JQuery.com]: https://img.shields.io/badge/jQuery-0769AD?style=for-the-badge&logo=jquery&logoColor=white
[JQuery-url]: https://jquery.com
